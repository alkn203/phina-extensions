phina.namespace(function(){phina.define("phina.accessory.Aim",{superClass:"phina.accessory.Accessory",init:function(t){this.superInit(t)},onattached:function(){},ondetached:function(){this.dest=null},aimTo:function(t){this.dest=t},update:function(){this.target&&this.target.setRotation(this.getDegree())},getDegree:function(){var t=Vector2.sub(this.dest,this.target);return Math.radToDeg(Math.atan2(t.y,t.x))+90}}),phina.app.Element.prototype.getter("aim",function(){return this._aim||(this._aim=phina.accessory.Aim().attachTo(this)),this._aim})}),phina.namespace(function(){phina.define("phina.accessory.Collider",{superClass:"phina.accessory.Accessory",init:function(t){this.superInit(t)},onattached:function(){this._collider||(this._collider=RectangleShape({width:this.target.width,height:this.target.height,fill:null}).addChildTo(this.target),this._collider.hide())},ondetached:function(){this._collider&&this._collider.remove()},show:function(){return this._collider.show(),this},hide:function(){return this._collider.hide(),this},offset:function(t,i){return this._collider.setPosition(t,i),this},setSize:function(t,i){return this._collider.setSize(t,i),this},hitTest:function(t){if(this.target){var i=this.getAbsoluteRect(),t=t.getAbsoluteRect();return phina.geom.Collision.testRectRect(i,t)}},getAbsoluteRect:function(){var t=this._collider.left+this.target.x,i=this._collider.top+this.target.y;return phina.geom.Rect(t,i,this._collider.width,this._collider.height)}}),phina.app.Element.prototype.getter("collider",function(){return this._collider||(this._collider=phina.accessory.Collider().attachTo(this)),this._collider})}),phina.namespace(function(){phina.define("phina.accessory.GridLayout",{superClass:"phina.accessory.Accessory",init:function(t){t={}.$safe(t||{},phina.accessory.GridLayout.defaults),this.superInit(t.target),this.cellWidth=t.cellWidth,this.cellHeight=t.cellHeight,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.maxPerLine=t.maxPerLine,this.arrangement="horizontal"},onattached:function(){this.reposition()},reposition:function(){var t=this.target.children;"horizontal"===this.arrangement&&t.each(function(t,i){var e=i%this.maxPerLine,i=i/this.maxPerLine|0,e=this.cellWidth*e+this.offsetX,i=this.cellHeight*i+this.offsetY;t.setPosition(e,i)},this)},_static:{defaults:{target:null,cellWidth:64,cellHeight:64,offsetX:32,offsetY:32,maxPerLine:10}}}),phina.app.Element.prototype.getter("gridlayout",function(){return this._gridlayout||(this._gridlayout=phina.accessory.GridLayout().attachTo(this)),this._gridlayout})}),phina.namespace(function(){phina.define("phina.accessory.RingLayout",{superClass:"phina.accessory.Accessory",init:function(t){t={}.$safe(t||{},phina.accessory.RingLayout.defaults),this.superInit(t.target),this.radius=t.radius,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.ringRotation=t.ringRotation,this.ringScaleX=t.ringScaleX,this.ringScaleY=t.ringScaleY},onattached:function(){this.reposition()},reposition:function(){var t=this.target.children,a=360/t.length;t.each(function(t,i){var e=Math.degToRad(a*i+this.ringRotation),i=this.radius*this.ringScaleX*Math.cos(e)+this.offsetX,e=this.radius*this.ringScaleY*Math.sin(e)+this.offsetY;t.setPosition(i,e)},this)},_static:{defaults:{target:null,radius:160,offsetX:320,offsetY:480,ringRotation:0,ringScaleX:1,ringScaleY:1}}}),phina.app.Element.prototype.getter("ringlayout",function(){return this._ringlayout||(this._ringlayout=phina.accessory.RingLayout().attachTo(this)),this._ringlayout})}),phina.namespace(function(){phina.define("phina.display.TypedLabel",{superClass:"phina.display.Label",init:function(t){t={}.$safe(t||{},phina.display.TypedLabel.defaults),this.superInit(t),this.text="",this.index=0,this.typedText=t.typedText,this.finished=!1,this.tweener.clear().to({index:this.typedText.length},t.duration).wait(100).call(function(){this.flare("typeend")},this)},update:function(){var t=this.typedText;this.text=t.substring(0,0|this.index).paddingRight(t.length)},_static:{defaults:{typedText:"Hello",duration:1e3}}})}),phina.namespace(function(){phina.define("phina.effect.Break",{superClass:"phina.display.DisplayElement",init:function(t){t={}.$safe(t||{},phina.effect.Break.defaults),this.superInit(t);var i=t.type,t=t.sprite;"mariolike"===i&&this._marioLike(t)},_marioLike:function(n){var h=n.image.domElement,r=n.width/2,o=n.height/2,l=phina.util.Grid(n.width,2),c=n.srcRect;4..times(function(t){var i=t%2,e=(t/2).floor(),a=phina.graphics.Canvas().setSize(r,o),s=c.x+i*r,t=c.y+e*o;a.context.drawImage(h,s,t,r,o,0,0,r,o);a=phina.display.Sprite(a).addChildTo(this),i=l.span(i)+n.x-a.width/2,e=l.span(e)+n.y-a.height/2;a.setPosition(i,e),a.rotation=45},this),this.spX=n.x,this.spY=n.y,n.remove(),[[-120,35],[-60,35],[-150,20],[-30,20]].each(function(t,i){i=this.children[i];i.physical.gravity.y=4.6,i.physical.velocity=phina.geom.Vector2().fromDegree(t[0],t[1])},this);var t=this;this.tweener.wait(500).call(function(){t.remove()})},_static:{defaults:{type:"mariolike",sprite:null}}})}),phina.namespace(function(){phina.define("phina.effect.Stump",{superClass:"phina.display.DisplayElement",init:function(t){var i=(t={}.$safe(t||{},phina.effect.Stump.defaults)).speed,e=t.target;e.setOrigin(.5,1),e.y+=e.height/2,e.tweener.to({scaleY:.1},i).call(function(){e.remove(),this.remove()},this).play()},_static:{defaults:{target:null,speed:200}}})}),phina.namespace(function(){phina.define("phina.ui.RingGauge",{superClass:"phina.display.PlainElement",init:function(t){t={}.$safe(t||{},phina.ui.RingGauge.defaults),this.radius=t.radius,this.superInit({width:2*this.radius,height:2*this.radius}),this.foreColor=t.foreColor,this.backColor=t.backColor,this.maxValue=t.maxValue,this.value=this.maxValue,this.startDeg=360,this.endDeg=0,this.redraw()},isFull:function(){return this.value===this.maxValue},isEmpty:function(){return 0===this.value},setValue:function(t){t=Math.clamp(t,0,this.maxValue),this.value!==t&&(this.value=t,this.flare("change"))},redraw:function(){var t=this.canvas,i=this.radius,e=(this.maxValue-this.value)/this.maxValue,a=Math.degToRad(this.startDeg-90),e=Math.degToRad(360*e-90);t.clear(),t.globalCompositeOperation="source-over",t.context.fillStyle=this.backColor,t.fillCircle(i,i,i),t.context.fillStyle=this.foreColor,t.beginPath(),t.moveTo(i,i).arc(i,i,i,a,e,!0),t.closePath(),t.fill(),t.globalCompositeOperation="xor",t.fillCircle(i,i,.5*i)},_static:{defaults:{radius:32,foreColor:"lime",backColor:"red",maxValue:100}}})}),phina.namespace(function(){phina.define("phina.ui.HeartGauge",{superClass:"phina.display.DisplayElement",init:function(t){t={}.$safe(t||{},phina.ui.HeartGauge.defaults),this.superInit(t);var i=DisplayElement().addChildTo(this),e=DisplayElement().addChildTo(this),a=t.gridSize,s=t.offset;this.heartRadius=a/2*.8,this.heartColor=t.heartColor,this.emptyColor=t.emptyColor;var n=t.colmun,h=t.defaultMax;this.maxValue=t.maxValue,this.animation=t.animation,this.grid=Grid({width:a*n,colmuns:n,offset:s});var r=this;h.times(function(t){r.createHeart("empty").addChildTo(i),r.createHeart().addChildTo(e)}),this.col=n,this.emptyGroup=i,this.heartGroup=e,this.reposition(i),this.reposition(e)},createHeart:function(t){t="empty"===t?this.emptyColor:this.heartColor;return HeartShape({radius:this.heartRadius,fill:t,stroke:null})},reposition:function(t){var a=this.col,s=this.grid;t.children.each(function(t,i){var e=i%a,i=(i/a).floor();t.setPosition(s.span(e),s.span(i))})},damage:function(t){var e,a;this.isEmpty()||((t=void 0===t?1:t)>=(e=this.heartGroup.children).length&&(t=e.length),(a=this).animation?t.times(function(t){var t=e.length-1-t,i=e[t];i.tweener.fadeOut(100).fadeIn(100).call(function(){i.remove(),a.isEmpty()&&a.flare("empty")}).play()}):(t.times(function(t){a.heartGroup.children.pop()}),a.isEmpty()&&a.flare("empty")))},recover:function(t){var i,e,a;this.isFull()||(e=(i=this).heartGroup,(a=this.emptyGroup.children.length-e.children.length)<=(t=void 0===t?1:t)&&(t=a),this.animation?t.times(function(t){i.createHeart().addChildTo(e).setScale(.1).tweener.scaleTo(1,200).call(function(){i.isFull()&&i.flare("full")}).play()}):(t.times(function(t){i.createHeart().addChildTo(e)}),this.isFull()&&this.flare("full")),this.reposition(e))},gainHeart:function(){var t;this.emptyGroup.children.length!==this.maxValue&&(this.createHeart("empty").addChildTo(this.emptyGroup),t=this.emptyGroup.children.length-this.heartGroup.children.length,this.recover(t),this.reposition(this.emptyGroup),this.reposition(this.heartGroup))},isFull:function(){var t=this.heartGroup.children.length;return 0<t&&t===this.emptyGroup.children.length},isEmpty:function(){return 0===this.heartGroup.children.length},_static:{defaults:{gridSize:64,offset:0,heartColor:"red",emptyColor:"gray",defaultMax:3,maxValue:20,colmun:10,animation:!0}}})}),phina.namespace(function(){phina.define("phina.ui.TimerGauge",{superClass:"phina.ui.Gauge",init:function(t){(t={}.$safe(t||{},phina.ui.TimerGauge.defaults)).maxValue=1e3*t.limitTime,this.superInit(t)},run:function(){this.update=this.elapse},pause:function(){this.update=null},recover:function(){this.pause(),this.value=this.maxValue},elapse:function(t){this.value-=t.deltaTime},_static:{defaults:{limitTime:60}}})}),phina.namespace(function(){phina.define("phina.util.Map",{superClass:"phina.display.DisplayElement",init:function(t){t={}.$safe(t||{},phina.util.Map.defaults),this.superInit(),this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.imageName=t.imageName,this.mapData=t.mapData,this.collisionData=t.collisionData,this.maxPerLine=this.mapData.first.length;var i=this;this._mapData=[],this.mapData.each(function(t){i._mapData=i._mapData.concat(t)}),this.collisionData&&(this._collisionData=[],this.collisionData.each(function(t){i._collisionData=i._collisionData.concat(t)})),this._createMap()},clear:function(){this.children.clear()},hitTest:function(t,i){t=t/this.tileWidth|0,i=i/this.tileHeight|0;return 1===this._collisionData[i*this.maxPerLine+t]},hitTestByIndex:function(t,i){return 1===this._collisionData[i*this.maxPerLine+t]},checkTile:function(t,i){t=t/this.tileWidth|0,i=i/this.tileHeight|0;return this._mapData[i*this.maxPerLine+t]},checkTileByVec:function(t){return this._mapData[t.y*this.maxPerLine+t.x]},checkTileByIndex:function(t,i){return this._mapData[i*this.maxPerLine+t]},setTile:function(t,i,e){t=t/this.tileWidth|0,i=i/this.tileHeight|0;this._mapData[i*this.maxPerLine+t]=e,this._createMap()},setTileByIndex:function(t,i,e){this._mapData[i*this.maxPerLine+t]=e,this._createMap()},setTileByVec:function(t,i){this._mapData[t.y*this.maxPerLine+t.x]=i,this._createMap()},getChild:function(t,i){t=t/this.tileWidth|0,i=i/this.tileHeight|0;return this.children[i*this.maxPerLine+t]},getChildByIndex:function(t,i){return this.children[i*this.maxPerLine+t]},coordToIndex:function(t){var i=Math.floor(t.x/this.tileWidth),t=Math.floor(t.y/this.tileHeight);return Vector2(i,t)},_createMap:function(){var s=this.tileWidth,n=this.tileHeight,h=this.maxPerLine,r=this;this._mapData.each(function(t,i){var e=i%h,a=Math.floor(i/h),i=s*e+s/2,e=n*a+n/2,a=phina.display.Sprite(r.imageName,s,n).addChildTo(r);a.setPosition(i,e),a.frameIndex=t})},_static:{defaults:{tileWidth:64,tileHeight:64,imageName:"",mapData:null,collisionData:null}}})});